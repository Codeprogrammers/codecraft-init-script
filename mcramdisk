#!/bin/bash
# /etc/init.d/mcramdisk
# version 0.1.0 2011-11-05 (YYYY-MM-DD)

### BEGIN INIT INFO
# Provides:   minecraft_ramdisk
# Required-Start: $local_fs $remote_fs
# Required-Stop:  $local_fs $remote_fs
# Should-Start:   
# Should-Stop:    
# Default-Start:  2 3 4 5
# Default-Stop:   0 1 6
# Short-Description:    Ramdisk for Minecraft
# Description:    Makes a Ramdisk for a Minecraft server
### END INIT INFO

#Settings
USERNAME="minecraft"
RD_PATH='/mnt/codecraft/ramdisk'
RD_SIZE='256M'

ME=`whoami`
as_user() {
  if [ $ME == $USERNAME ] ; then
    bash -c "$1"
  else
    su - $USERNAME -c "$1"
  fi

mcrd_start() {
  if mount -l -t tmpfs | grep $RD_PATH > /dev/null
  then 
    echo "Ramdisk already mounted"
  else
    echo "Mounting Ramdisk at $RD_PATH"
    as_user "mount -t tmpfs -o size=$RD_SIZE tmpfs $RD_PATH"
    sleep 7
    if mount -l -t tmpfs | grep $RD_PATH > /dev/null
    then 
      echo "Ramdisk mounted at $RD_PATH"
    else
      echo "Could not mount Ramdisk. Does $RD_PATH exist?"
    fi
  fi
